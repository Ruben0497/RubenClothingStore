@model RubenClothingStore.Models.ClothingItem
@{
    ViewData["Title"] = "Clothing Item Details";
    var userId = Context.Session.GetInt32("UserId");
    var isLoggedIn = userId.HasValue && userId.Value > 0;
    var isAdmin = Context.Session.GetString("IsAdmin") == "true";
}

<h2>@Model.Name</h2>

<div class="mb-4 text-center">
    @if (Model.ImageData != null)
    {
        var base64 = Convert.ToBase64String(Model.ImageData);
        var imgSrc = $"data:{Model.ImageMimeType};base64,{base64}";
        <img src="@imgSrc" alt="@Model.Name" style="max-width: 300px; width: 100%; height: auto; border-radius: 8px;" />
    }
    else
    {
        <p>No image available</p>
    }
</div>

<div class="mb-3"><strong>Price:</strong> $@Model.Price.ToString("F2")</div>
<div class="mb-3"><strong>Size:</strong> @Model.Size</div>
<div class="mb-3"><strong>Description:</strong><br />@Model.Description</div>

<div class="mt-4">
    @if (isLoggedIn)
    {
        <form asp-controller="Cart" asp-action="BuyNow" method="post" style="display:inline;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />
            <input type="hidden" name="size" value="@Model.Size" />
            <button type="submit" class="btn btn-success">Buy</button>
        </form>
    }
    else
    {
        <a class="btn btn-success"
           asp-controller="Account" asp-action="Login"
           asp-route-returnUrl="@Url.Action("Details", "Clothing", new { id = Model.Id })">
            Login to Buy
        </a>
    }
</div>

@if (isAdmin)
{
    <hr />
    <div class="mt-3">
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning me-2">Edit Item</a>
        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">Delete Item</a>
    </div>
}

<div class="mt-4">
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>
